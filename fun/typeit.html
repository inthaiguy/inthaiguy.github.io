<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Quirky Text Editor</title>
    <style>
        /* Style the main container */
        .editor-container {
            width: 80%;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-family: Arial, sans-serif;
        }

        /* The typing area (editable div) */
        #editor {
            width: 100%;
            height: 300px;
            border: none;
            outline: none;
            padding: 10px;
            background-color: #fff;
            font-size: 16px;
            line-height: 1.5;
            white-space: pre-wrap; /* Keep formatting like line breaks */
            overflow-wrap: break-word; /* Break long words if needed */
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Style for "a" characters (double size) */
        .large-a {
            font-size: 32px;
            font-weight: bold;
        }

        /* Style for "b" characters (half size) */
        .small-b {
            font-size: 8px;
        }

        /* Style for "c" spinning */
        .spin-c {
            display: inline-block;
            animation: spin 0.5s linear;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Style for "d" being 25% larger */
        .large-d {
            font-size: 20px;
        }

        /* Style for "e" being red */
        .red-e {
            color: red;
        }

        /* Style for "g" fading in */
        .fade-g {
            opacity: 0;
            animation: fadeIn 2s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Style for "h" being blue */
        .blue-h {
            color: blue;
        }

        /* Style for "j" tilted */
        .tilt-j {
            display: inline-block;
            transform: rotate(5deg);
        }

        /* Style for "k" wobble */
        .wobble-k {
            display: inline-block;
            animation: wobble 1s infinite;
        }

        @keyframes wobble {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }

        /* Style for "l" spinning 4 times */
        .spin-l {
            display: inline-block;
            animation: spin 0.5s linear 4;
        }

        /* Style for "m" rotating 180 degrees then flipping */
        .flip-m {
            display: inline-block;
            transform: rotate(180deg);
            transition: transform 0.1s;
        }

        /* Style for "n" being grey and double sized */
        .large-n {
            font-size: 32px;
            color: grey;
        }

        /* Style for "o" spinning vertically */
        .spin-o {
            display: inline-block;
            animation: spinY 0.1s linear infinite;
        }

        @keyframes spinY {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        /* Style for "p" rotating vertically */
        .rotate-p {
            display: inline-block;
            transform: rotateX(180deg);
            transition: transform 0.2s;
        }

        /* New styles for the additional characters */

        /* "x" - grey, 90% larger, fades in */
        .large-grey-x {
            font-size: 30px;
            color: grey;
            opacity: 0;
            animation: fadeInX 1s forwards;
        }

        @keyframes fadeInX {
            to { opacity: 1; }
        }

        /* "y" - green */
        .green-y {
            color: green;
        }

        /* "z" - 10% smaller */
        .small-z {
            font-size: 14px;
        }

        /* "r" and "q" - green and uppercase */
        .green-r, .upper-q {
            color: green;
        }

        /* "s" - rotated 10 degrees */
        .rotate-s {
            display: inline-block;
            transform: rotate(10deg);
        }

        /* "t" - blue and double size */
        .blue-t {
            font-size: 32px;
            color: blue;
        }

        /* "u" - mirrored horizontally */
        .mirror-u {
            display: inline-block;
            transform: scaleX(-1);
        }

        /* "v" - grows to double size */
        .grow-v {
            display: inline-block;
            transform: scale(1);
            animation: grow 0.1s forwards;
        }

        @keyframes grow {
            to { transform: scale(2); }
        }

        /* "w" - starts rotated 180 degrees */
        .rotate-w {
            display: inline-block;
            transform: rotate(180deg);
        }
    </style>
</head>
<body>

<div class="editor-container">
    <h2>Quirky Text Editor</h2>
    <div id="editor" contenteditable="true" placeholder="Start typing..."></div>
</div>

<script>
    const editor = document.getElementById('editor');
    let delayedF = false;  // Keep track of delayed "f"
    let effectsCount = {}; // Keep track of how many times each effect has happened

    // Check if effect limit is reached (3 times per character)
    function canApplyEffect(char) {
        if (!effectsCount[char]) effectsCount[char] = 0;
        if (effectsCount[char] < 3) {
            effectsCount[char]++;
            return true;
        }
        return false;
    }

    // Listen for input in the editable div
    editor.addEventListener('input', function(event) {
        let text = editor.innerText;  // Get the current text
        editor.innerHTML = '';  // Clear the editor to replace with styled text

        // Process each character and apply quirky variations
        for (let i = 0; i < text.length; i++) {
            let char = text[i];
            let span = document.createElement('span');  // Create a span for each character
            span.textContent = char;  // Set the text for the span

            // Apply quirky styles
            if (char === 'a' && canApplyEffect('a')) {
                span.classList.add('large-a');
            } else if (char === 'b' && canApplyEffect('b')) {
                span.classList.add('small-b');
            } else if (char === 'c' && canApplyEffect('c')) {
                span.classList.add('spin-c');
            } else if (char === 'd' && canApplyEffect('d')) {
                span.classList.add('large-d');
            } else if (char === 'e' && canApplyEffect('e')) {
                span.classList.add('red-e');
            } else if (char === 'f' && !delayedF) {
                delayedF = true;
                continue;  // Skip until the next key press
            } else if (char === 'g' && canApplyEffect('g')) {
                span.classList.add('fade-g');
            } else if (char === 'h' && canApplyEffect('h')) {
                span.classList.add('blue-h');
            } else if (char === 'j' && canApplyEffect('j')) {
                span.classList.add('tilt-j');
            } else if (char === 'k' && canApplyEffect('k')) {
                span.classList.add('wobble-k');
            } else if (char === 'l' && canApplyEffect('l')) {
                span.classList.add('spin-l');
            } else if (char === 'm' && canApplyEffect('m')) {
                span.classList.add('flip-m');
                setTimeout(() => {
                    span.style.transform = 'rotate(360deg)';
                }, 100);  // Flip after 100ms
            } else if (char === 'n' && canApplyEffect('n')) {
                span.classList.add('large-n');
            } else if (char === 'o' && canApplyEffect('o')) {
                span.classList.add('spin-o');
                setTimeout(() => { span.classList.remove('spin-o'); }, 100);  // Spin for 100ms
            } else if (char === 'p' && canApplyEffect('p')) {
                span.classList.add('rotate-p');
                setTimeout(() => {
                    span.style.transform = 'rotateX(0deg)';
                }, 200);  // Rotate back after 200ms
            } else if (char === 'q' && canApplyEffect('q')) {
                span.textContent = 'Q'; // Print as uppercase Q
            } else if (char === 'r' && canApplyEffect('r')) {
                span.classList.add('green-r');
            } else if (char === 's' && canApplyEffect('s')) {
                span.classList.add('rotate-s');
            } else if (char === 't' && canApplyEffect('t')) {
                span.classList.add('blue-t');
            } else if (char === 'u' && canApplyEffect('u')) {
                span.classList.add('mirror-u');
            } else if (char === 'v' && canApplyEffect('v')) {
                span.classList.add('grow-v');
            } else if (char === 'w' && canApplyEffect('w')) {
                span.classList.add('rotate-w');
            } else if (char === 'x' && canApplyEffect('x')) {
                span.classList.add('large-grey-x');
            } else if (char === 'y' && canApplyEffect('y')) {
                span.classList.add('green-y');
            } else if (char === 'z' && canApplyEffect('z')) {
                span.classList.add('small-z');
            }

            editor.appendChild(span);  // Add the span back to the editor
        }

        delayedF = false;  // Reset delayed F after processing
        placeCaretAtEnd(editor);  // Move the cursor to the end
    });

    // Function to move the caret (cursor) to the end of the contenteditable div
    function placeCaretAtEnd(el) {
        el.focus();
        if (typeof window.getSelection != 'undefined' && typeof document.createRange != 'undefined') {
            let range = document.createRange();
            range.selectNodeContents(el);
            range.collapse(false);
            let sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        }
    }
</script>

</body>
</html>