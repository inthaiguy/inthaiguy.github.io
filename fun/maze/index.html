<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chase the Green Dot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        #board {
            display: grid;
            grid-template-columns: repeat(20, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 2px;
            margin-top: 20px;
        }
        .cell {
            width: 30px;
            height: 30px;
            background-color: lightgrey;
            border: 1px solid #000;
        }
        .player {
            background-color: blue;
        }
        .goal {
            background-color: green;
        }
        .obstacle {
            background-color: grey;
        }
        #scoreboard {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Chase the Green Dot</h1>
    <div id="board"></div>
    <div id="scoreboard">
        <h2>High Scores</h2>
        <ul id="scoreList"></ul>
    </div>

    <script>
        const boardSize = 20; // 20x20 grid
        let board = [];
        let playerPos = { x: Math.floor(boardSize / 2), y: Math.floor(boardSize / 2) };
        let goalPos = { x: Math.floor(Math.random() * boardSize), y: Math.floor(Math.random() * boardSize) };
        let obstacles = [];
        let startTime;
        let gameFinished = false;
        let goalTimeout;

        // Initialize the board with empty cells and obstacles
        function initializeBoard() {
            board = Array.from({ length: boardSize }, () => Array(boardSize).fill(0));

            // Place random obstacles (gray blocks) on the board
            obstacles = [];
            for (let i = 0; i < 50; i++) { // 50 random obstacles
                const ox = Math.floor(Math.random() * boardSize);
                const oy = Math.floor(Math.random() * boardSize);
                if ((ox !== playerPos.x || oy !== playerPos.y) && (ox !== goalPos.x || oy !== goalPos.y)) {
                    obstacles.push({ x: ox, y: oy });
                    board[oy][ox] = 1; // 1 means obstacle
                }
            }

            drawBoard();
        }

        // Draw the board grid
        function drawBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            for (let y = 0; y < boardSize; y++) {
                for (let x = 0; x < boardSize; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (x === playerPos.x && y === playerPos.y) {
                        cell.classList.add('player');
                    }
                    if (x === goalPos.x && y === goalPos.y) {
                        cell.classList.add('goal');
                    }
                    if (board[y][x] === 1) {
                        cell.classList.add('obstacle');
                    }
                    boardElement.appendChild(cell);
                }
            }
        }

        // Move the player
        function movePlayer(dx, dy) {
            if (gameFinished) return;
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;

            if (newX >= 0 && newX < boardSize && newY >= 0 && newY < boardSize && board[newY][newX] !== 1) {
                playerPos.x = newX;
                playerPos.y = newY;

                // Check if player reaches the goal
                if (playerPos.x === goalPos.x && playerPos.y === goalPos.y) {
                    finishGame();
                }
            }

            drawBoard();
        }

        // Finish the game and ask for the player's name
        function finishGame() {
            clearTimeout(goalTimeout);
            gameFinished = true;
            const endTime = new Date();
            const score = Math.round((endTime - startTime) / 1000);
            const playerName = prompt("Enter your 3-letter name:");
            updateScores(playerName, score);

            // Restart the game after a short delay
            setTimeout(startGame, 2000);
        }

        // Move the goal (green dot) to a new random location every few seconds
        function moveGoal() {
            goalPos = {
                x: Math.floor(Math.random() * boardSize),
                y: Math.floor(Math.random() * boardSize)
            };

            // Ensure the goal doesn't land on an obstacle or the player
            while (board[goalPos.y][goalPos.x] === 1 || (goalPos.x === playerPos.x && goalPos.y === playerPos.y)) {
                goalPos = {
                    x: Math.floor(Math.random() * boardSize),
                    y: Math.floor(Math.random() * boardSize)
                };
            }

            drawBoard();
            goalTimeout = setTimeout(moveGoal, 4000); // Move every 5 seconds
        }

        // Handle player movement with arrow keys
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp': movePlayer(0, -1); break;
                case 'ArrowDown': movePlayer(0, 1); break;
                case 'ArrowLeft': movePlayer(-1, 0); break;
                case 'ArrowRight': movePlayer(1, 0); break;
            }
        });

        // Initialize the game
        function startGame() {
            playerPos = { x: Math.floor(boardSize / 2), y: Math.floor(boardSize / 2) };
            startTime = new Date();
            gameFinished = false;
            initializeBoard();
            moveGoal();
        }

        // High scores using cookies
        function getScores() {
            const cookie = document.cookie.split('; ').find(row => row.startsWith('chaseScores='));
            return cookie ? JSON.parse(decodeURIComponent(cookie.split('=')[1])) : [];
        }

        function setScores(scores) {
            document.cookie = `chaseScores=${encodeURIComponent(JSON.stringify(scores))}; path=/; max-age=31536000`;
        }

        function updateScores(name, score) {
            const scores = getScores();
            scores.unshift({ name, score });
            if (scores.length > 10) scores.pop(); // Keep only the last 10 scores
            setScores(scores);
            displayScores();
        }

        function displayScores() {
            const scores = getScores();
            const scoreList = document.getElementById('scoreList');
            scoreList.innerHTML = '';
            scores.forEach(({ name, score }) => {
                const li = document.createElement('li');
                li.textContent = `${name} - ${score} seconds`;
                scoreList.appendChild(li);
            });
        }

        // Start the game
        startGame();
        displayScores();
    </script>
</body>
</html>